# AI语音助手

## 实物图

![实物图](picture/ai_voice_assistant.png)

## 概述

AI语音助手是一款集成先进语音识别和AI对话能力的智能语音助手，在具备自然语音交互功能的基础上，新增加了外设控制指令串口输出功能，当用户发出自然语言指令（如"请打开灯"）时，AI语音助手将通过配置的知识库查询预设的"语音指令-串口指令"映射关系获取指令，并通过指定串口输出对应的标准化控制指令（如turn on led），供外部设备接收并执行。

用户可通过简单配置自定义外设控制语音指令与串口指令的映射关系，即可快速实现语音控制LED、电机、舵机等多种外设功能，大幅降低智能语音交互的开发门槛。

## 固件下载

<a href="https://gh-proxy.com/https://github.com/nulllaborg/xiaozhi_ai_vox3_ai_smart/archive/refs/tags/v1.0.0.zip" download>点击此处下载固件</a>

## 串口参数配置

| 串口参数  | 配置     | 说明                     |
| -------- | -------- | ----------------------- |
| RX引脚    | IO引脚5  | 接引外部串口工具的TX引脚  |
| TX引脚    | IO引脚6  | 接引外部串口工具的RX引脚  |
| 波特率    | 115200   | 波特率固定为115200       |

**注意：串口接线需遵循 “交叉连接” 原则（本设备的TX接对端的RX，本设备的RX接对端的TX），接反会导致指令无法接收。**

## 知识库配置

使用此模块时，需要登录小智后台进行相应智能体的知识库配置，才能正常使用此模块。

### 关于知识库

知识库用于存储“用户语音指令”与“串口输出指令”之间的映射关系。当小智AI识别到用户语音指令后，会查询知识库中是否匹配对应条目，若匹配则通过串口发送相应指令。

### 知识库配置步骤

#### 第一步：创建外设控制指令表（Excel）

新建Excel文件，在该文件中按照以下格式输入外设控制的相应指令，然后保存。指令格式参考如下

| 外设控制  | 串口发送指令     | 备注                     |
| -------- | --------------- | ------------------------ |
| 打开灯    | turn on led     |                         |
| 关闭灯    | turn off led    |                         |
| 电机      | dc run speed x  | x代表转动速度，其绝对值为速度大小，正负代表旋转方向，速度大小为0~255，x默认为100  |

---

#### 第二步：新建知识库

1. 登录小智后台<a href="https://xiaozhi.me/" target="_blank">xiaozhi.me/</a>
2. 点击进入【知识库】模块
3. 点击【新建知识库】按钮
4. 在弹窗里填写相关信息，创建知识库：
    - 知识库名称：会在智能体配置时，显示在知识库列表里；
    - 知识库描述： 介绍该知识库的作用，AI会根据介绍内容来决定是否调用该知识库，以及使用效果；知识库描述词会直接影响AI调用逻辑，描述词应尽可能准确描述。
5. 完成知识库的创建。

**知识库描述参考（重要‼️）**

```text
本文档包含“外设控制的串口发送指令”内容，当用户提及外设控制时（如打开灯），我不能直接作答，必须在每次对话中调用该工具查询资料后，再调用相应MCP功能进行发送相应文本，注意，外设控制必须是在此资料中已有，如若在此资料中匹配不到相应外设控制，则应当回复暂时无法设置此功能。
```

![进入知识库图](picture/knowledge_base.png)
![创建知识库图](picture/new_knowledge_base.png)

---

#### 第三步：上传指令文档

1. 在知识库列表中，找到刚刚创建的知识库，点击【查看】按钮，进入文档上传页面。
2. 点击右上角的【新建文档】按钮。
3. 选择第一步中新建的外设控制指令文档，并点击【确定】上传。
4. 文档上传成功后，系统会自动解析文档，解析完成后，状态会变成【解析完成】。

![查看知识库图](picture/knowledge_base_view.png)
![新建文件图](picture/upload_document.png)
![上传文件图](picture/add_document.png)
![选择文件图](picture/add_document_two.png)
![文件上传成功图](picture/upload_success.png)

---

#### 第四步：关联知识库

1. 进入小智后台 "控制台→智能体"模块页面；
2. 选择需要使用的智能体，点击【配置角色】；
3. 在配置角色页面，下拉找到并点击展开【MCP设置】；
4. 在"官方服务"中勾选【知识库】功能；
5. 在下方【知识库配置】列表中，选择刚刚创建的外设控制指令知识库；
6. 点击【保存】，并按提示重启设备，使配置生效。

![进入知识库图](picture/role_configuration.png)
![进入知识库图](picture/knowledge_add.png)
![进入知识库图](picture/add_knowledge_success.png)

---

## Arduino 使用示例

### 硬件准备

- Arduino uno 开发板

- AI语音助手（已配置好相应知识库）

- LED灯

- SG90舵机

- R300C电机风扇

### 接线

| 模块            | Arduino 开发板引脚  |
| --------------- | ------------------ |
| AI语音助手引脚5  | 12                 |
| AI语音助手引脚6  | 13                 |
| LED灯           | 3                  |
| SG90舵机        | 4                  |
| R300C电机INA    | 5                  |
| R300C电机INB    | 6                  |

### 接线图

![接线图](picture/wiring_diagram.jpg)

### 程序下载

点击下方链接下载示例程序，下载后解压用Arduino IDE打开示例文件，主板选择Arduino uno。

<a href="https://gh-proxy.com/https://github.com/emakefun-arduino-library/example_ai_voice_assistant/archive/refs/tags/v1.0.0.zip" download>点击此处下载示例程序</a>

### 使用说明

配置好AI语音助手的知识库，以及将示例程序烧录到主板之后，给主板通电，用户可通过语音发出控制指令。语音助手识别到指令后，会通过串口向Arduino Uno发送对应的控制指令（如"turn on led"）。Arduino接收到指令后进行解析和匹配，最终控制相应的外设执行动作。

例如，对语音助手说"舵机转到150度"，语音助手通过串口发送"servo set angle 150"指令，Arduino识别后即控制舵机旋转至150度位置。
